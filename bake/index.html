<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bake</title>
    <style>
        body { padding: 1.5rem; }
        input { width: 5rem; }
        select { width: 7rem; }
    </style>
</head>
<body>
    <table>
        <tbody>
            <tr>
                <td>Preset</td>
                <td>
                    <select id="profile">
                        <option value="baguette" selected>Baguette</option>
                        <option value="pizza">Pizza</option>
                        <option value="1:1:1">1:1:1</option>
                        <option value="1:2:2">1:2:2</option>
                        <option value="poolish">Poolish Starter</option>
                        <option value="dry">Dry Starter</option>
                    </select>
                </td>
            </tr>
            <tr id="total">
                <td>Target Weight</td>
                <td><input type="number">g</td>
            </tr>
            <tr id="hydration">
                <td>Target Hydration</td>
                <td><input type="number" min="1" max="100">%</td>
                <td></td>
            </tr>
            <tr id="flour">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="levain">
                <td>Levain</td>
                <td><input type="number" min="0">%</td>
                <td></td>
            </tr>
            <tr id="lvh">
                <td>Levain Hydration</td>
                <td><input type="number" min="1" max="100">%</td>
                <td></td>
            </tr>
            <tr id="oil">
                <td>Oil</td>
                <td><input type="number">%</td>
                <td></td>
            </tr>
            <tr id="salt">
                <td>Salt</td>
                <td><input type="number">%</td>
                <td></td>
            </tr>
        </tbody>
    </table>
    <script>
        const inputs = ["total", "hydration", "levain", "lvh", "oil", "salt"];

        function calc() {
            const args = {};
            for(let i of inputs) {
                args[i] = parseFloat(document.querySelector(`#${i} input`).value);
                if(!Number.isFinite(args[i])) return;
            }
            const t = args.total;
            const h = args.hydration/100;
            const l = args.levain/100;
            const v = args.lvh/100; // levain hydration

            const totalFlour = t/(h+1);
            const totalWater = t-totalFlour;
            const additionalFlour = (totalFlour * (v+1)) / (l+v+1);
            const levainTotal = l * additionalFlour;
            const levainFlour = levainTotal / (v+1);
            const oil = (args.oil/100) * additionalFlour;
            const additionalWater = totalWater - (levainTotal - levainFlour) - oil;
            const salt = (args.salt/100) * additionalFlour;

            document.querySelector(`#hydration td:last-child`).textContent = `${Math.round(additionalWater)}g Water`;
            document.querySelector(`#flour td:last-child`).textContent = `${Math.round(additionalFlour)}g Flour`;
            document.querySelector(`#levain td:last-child`).textContent = `${Math.round(levainTotal)}g`;
            document.querySelector(`#oil td:last-child`).textContent = `${Math.round(oil)}g`;
            document.querySelector(`#salt td:last-child`).textContent = `${Math.round(salt)}g`;
        }
        
        for(let i of inputs) {
            document.querySelector(`#${i} input`).addEventListener("change", calc);
        }

        function applyProfile() {
            const profile = {
                baguette: { total: 500, hydration: 68, levain: 20, lvh: 100, oil: 0, salt: 1.8 },
                pizza: { total: 500, hydration: 60, levain: 20, lvh: 100, oil: 3, salt: 2.2 },
                "1:1:1": { total: 100, hydration: 100, levain: 100, lvh: 100, oil: 0, salt: 0 },
                "1:2:2": { total: 100, hydration: 100, levain: 50, lvh: 100, oil: 0, salt: 0 },
                dry: { total: 100, hydration: 50, levain: 100, lvh: 100, oil: 0, salt: 0 },
                poolish: { total: 100, hydration: 100, levain: 100, lvh: 50, oil: 0, salt: 0 },
            };
            for(let [k, v] of Object.entries(profile[document.querySelector("#profile").value])) {
                document.querySelector(`#${k} input`).value = v;
            }
            calc();
        }

        document.querySelector(`#profile`).addEventListener("change", applyProfile);
        if(!document.querySelector(`#total input`).value) applyProfile();
        
    </script>
</body>
</html>
